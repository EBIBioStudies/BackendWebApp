<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>

<script type="text/javascript" src="http://www.google.com/recaptcha/api/js/recaptcha_ajax.js"></script>

<script type="text/javascript">

	String.prototype.escapeSpecialChars = function() {
	 return this.replace(/\\n/g, "\\n")
	            .replace(/\\'/g, "\\'")
	            .replace(/\\"/g, '\\"')
	            .replace(/\\&/g, "\\&")
	            .replace(/\\r/g, "\\r")
	            .replace(/\\t/g, "\\t")
	            .replace(/\\b/g, "\\b")
	            .replace(/\\f/g, "\\f");
	};

 function showRecaptcha(element)
 {
  Recaptcha.create("6Lcmlv0SAAAAAHofnIcb29l1LMZsnGFcSlH8Reve", element,
  {
   theme : "red",
   callback : Recaptcha.focus_response_field
  });
 }

 function signup()
 {
  var login = document.getElementById("login").value;
  var pass1 = document.getElementById("pass1").value;
  var pass2 = document.getElementById("pass2").value;
  var email = document.getElementById("email").value.trim();
  var uname = document.getElementById("username").value.trim();
  
  if( email.length == 0 )
  {
   msg("Email can't be empty");
   return;
  }
  
  if( pass1 != pass2 )
  {
   msg("Password doesn't match");
   return;
  }   
  
  var xmlhttp = new XMLHttpRequest();
  
  xmlhttp.onreadystatechange = function()
  {
   if (xmlhttp.readyState != 4)
    return;
   
   Recaptcha.reload();
   
   var ctype = xmlhttp.getResponseHeader("Content-type");
   
   if( ctype != null )
   {
    var pos = ctype.indexOf(';');
    
    if( pos != -1 )
     ctype = ctype.substring(0,pos);
    
    ctype = ctype.trim();
   }
   
   var jsonObj;
   
   if( ctype == "application/json")
    jsonObj = JSON.parse(xmlhttp.responseText);
   
   var msg="";
   
   if( xmlhttp.status == 200 )
   {
    msg +="Request succeeded Status: 200";
    
    if( jsonObj != null )
     msg+="\nHello "+jsonObj.username+"\nSession key: "+jsonObj.sessid;
    
   }
   else
   {
    msg +="Request failed. Status: "+xmlhttp.status;
    
    if( jsonObj != null )
     msg+="\nError message: "+jsonObj.message;
   }
   
   
   
   document.getElementById("response").innerHTML = msg;
  }
  
  
  xmlhttp.open("POST", "../auth/signup", true);
  xmlhttp.setRequestHeader("Content-type", "application/json");

  xmlhttp.send("{ login: \"" + login.escapeSpecialChars() + "\","
   +"password: \"" + pass1.escapeSpecialChars()  +  "\","
   +"username: \"" + uname.escapeSpecialChars()  +  "\","
   +"email: \"" + email.escapeSpecialChars()  +  "\","
   +"recaptcha_challenge: \"" + Recaptcha.get_challenge().escapeSpecialChars()  +  "\","
   +"recaptcha_response: \"" + Recaptcha.get_response().escapeSpecialChars()  +  "\","
   + "}");

  
  
 }
 
 function msg( txt )
 {
  document.getElementById("response").innerHTML=txt;
 }
 
 </script>


</head>
<body onLoad="showRecaptcha('captcha')">

<div style="margin: 50px">

<table>

<tr><td>Login:</td><td><input type="text" id="login" style="width: 200px"></td></tr>
<tr><td>User name:</td><td><input type="text" id="username" style="width: 200px"></td></tr>
<tr><td>Password:</td><td><input type="password" id="pass1" style="width: 200px"></td></tr>
<tr><td>Password confirm:</td><td><input type="password" id="pass2" style="width: 200px"></td></tr>
<tr><td>Email:</td><td><input type="text" id="email" style="width: 200px"></td></tr>

</table>
<br/>
<form>
<div id="captcha"></div>
</form>
<br/>
<button onClick="signup()"> Signup </button>
<br/>
<pre id="response">
</pre>
</div>

</body>

<!-- 

Public Key: 	6Lcmlv0SAAAAAHofnIcb29l1LMZsnGFcSlH8Reve

Use this in the JavaScript code that is served to your users
Private Key: 	6Lcmlv0SAAAAANysy6M8YdozfJnOQxc2JB9WaOS1 
 -->
</html>
